import{_ as p}from"./MTKMPC_17_40_08-555ce9c3.js";import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as r,a as s,b as a,d as e,w as l,f as n}from"./app-daf6f9ff.js";const m="/assets/image/07Control/MTKMPC_17_53_09.png",u="/assets/image/07Control/MTKMPC_17_57_10.png",d={},h=n(`<h1 id="mtk求解mpc问题" tabindex="-1"><a class="header-anchor" href="#mtk求解mpc问题" aria-hidden="true">#</a> MTK求解MPC问题</h1><p>!!! tip<br> Contents：MTK、Control</p><pre><code>Contributor: YJY

Email:522432938@qq.com

如有错误，请批评指正。
</code></pre><p>!!! note</p><pre><code>MPC = Model Predict Control

MTK = ModelingToolkit.jl

[OptimizationSystem](https://mtk.sciml.ai/stable/tutorials/optimization/)为MTK中的系统类型之一
</code></pre><h2 id="mtk中的controlsystem" tabindex="-1"><a class="header-anchor" href="#mtk中的controlsystem" aria-hidden="true">#</a> MTK中的ControlSystem</h2><p>在ModellingToolkit的Optimal Control中，有关于ControlSystem的描述。但经过实验测试，ControlSystem并不能很好地求解“过程控制量”的值。</p>`,7),k=s("br",null,null,-1),g=n('<h2 id="mtk中的optimizationsystem" tabindex="-1"><a class="header-anchor" href="#mtk中的optimizationsystem" aria-hidden="true">#</a> MTK中的OptimizationSystem</h2><p>为了简单起见，手动构建一个MPC优化问题，通过OptimizationSystem来求解。通过构建优化目标方程，调用不同优化器求解该优化问题。那么从控制问题到优化问题这一过程可以看成是手动离散。相当于自己实现了runge_kutta_discretize。构建完优化问题，就可以直接把它推给OptimizationProblem求解，这是可以做到的。</p><p><strong>上述过程的核心就是把控制中的状态量手写出来</strong>。</p><p>可行的做法是，<strong>通过MTK符号建模体系建立优化变量，同时构建Loss方程关于优化变量的符号表达。通过OptimizationSystem生成用符号体系构建的优化问题，把构建的OptimizationSystem推给OptimizationProblem，最后选择合适的求解器求解</strong>。</p><h2 id="实例-加热器问题" tabindex="-1"><a class="header-anchor" href="#实例-加热器问题" aria-hidden="true">#</a> 实例：加热器问题</h2><h3 id="问题描述" tabindex="-1"><a class="header-anchor" href="#问题描述" aria-hidden="true">#</a> 问题描述</h3>',6),v=s("p",null,[a("现在有一个物体加热，它的温度由加热项和散热项决定。α是散热系数，β是加热系数，环境温度为"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"T"),s("mrow",null,[s("mi",null,"o"),s("mi",null,"u"),s("mi",null,"t")])])]),s("annotation",{encoding:"application/x-tex"},"T_{out}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8333em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2806em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.1389em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"o"),s("span",{class:"mord mathnormal mtight"},"u"),s("span",{class:"mord mathnormal mtight"},"t")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a("。那么控制方程:")],-1),b=s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"T"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")]),s("mo",null,"="),s("mi",null,"α"),s("mo",null,"∗"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"T"),s("mrow",null,[s("mi",null,"o"),s("mi",null,"u"),s("mi",null,"t")])]),s("mo",null,"−"),s("mi",null,"T"),s("mo",{stretchy:"false"},")"),s("mo",null,"+"),s("mi",null,"β"),s("mo",null,"∗"),s("mi",null,"Q"),s("mo",{stretchy:"false"},"("),s("mi",null,"t"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"}," T' = α*(T_{out} - T) + β*Q(t) ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8019em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8019em"}},[s("span",{style:{top:"-3.113em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.4653em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.0037em"}},"α"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.2806em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.1389em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"o"),s("span",{class:"mord mathnormal mtight"},"u"),s("span",{class:"mord mathnormal mtight"},"t")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"mclose"},")"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"+"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.05278em"}},"β"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"∗"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"Q"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"t"),s("span",{class:"mclose"},")")])])])])],-1),y=s("p",null,[a("现在可以改变加热功率，那么我们构建一个优化问题：调节加热功率，使得物体的温度从"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"T"),s("mn",null,"0")])]),s("annotation",{encoding:"application/x-tex"},"T_{0}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8333em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.1389em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"0")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a("开始，迅速上升并且稳定在某一个温度（比如说58℃）。问题的数学表达为，通过优化控制变量"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"Q"),s("mo",{stretchy:"false"},"("),s("mi",null,"t"),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"Q(t)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"Q"),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"t"),s("span",{class:"mclose"},")")])])]),a(" 使得损失函数最小:")],-1),x=s("p",{class:"katex-block"},[s("span",{class:"katex-display"},[s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[s("semantics",null,[s("mrow",null,[s("mi",null,"L"),s("mi",null,"o"),s("mi",null,"s"),s("mi",null,"s"),s("mo",null,"="),s("munder",null,[s("mo",null,"∑"),s("mi",null,"i")]),s("mi",{mathvariant:"normal"},"∣"),s("mi",{mathvariant:"normal"},"∣"),s("mn",null,"58.0"),s("mo",null,"−"),s("mi",null,"T"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"t"),s("mi",null,"i")]),s("mo",{stretchy:"false"},")"),s("mi",{mathvariant:"normal"},"∣"),s("mi",{mathvariant:"normal"},"∣")]),s("annotation",{encoding:"application/x-tex"}," Loss = \\sum_{i} ||58.0-T(t_i)|| ")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6833em"}}),s("span",{class:"mord mathnormal"},"L"),s("span",{class:"mord mathnormal"},"oss"),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),s("span",{class:"mrel"},"="),s("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"2.3277em","vertical-align":"-1.2777em"}}),s("span",{class:"mop op-limits"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.05em"}},[s("span",{style:{top:"-1.8723em","margin-left":"0em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight"},"i")])])]),s("span",{style:{top:"-3.05em"}},[s("span",{class:"pstrut",style:{height:"3.05em"}}),s("span",null,[s("span",{class:"mop op-symbol large-op"},"∑")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"1.2777em"}},[s("span")])])])]),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},"∣∣58.0"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),s("span",{class:"mbin"},"−"),s("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3117em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"i")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mclose"},")"),s("span",{class:"mord"},"∣∣")])])])])],-1),_=s("p",null,[a("而"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"Q"),s("mo",{stretchy:"false"},"("),s("msub",null,[s("mi",null,"t"),s("mi",null,"i")]),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"Q(t_i)")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord mathnormal"},"Q"),s("span",{class:"mopen"},"("),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"t"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3117em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"i")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mclose"},")")])])]),a("就是未来一段时间域内，不同时间点上的控制量（控制科学中称为状态量）。通过改变这些值，能够控制温度的走势，这是控制的内涵。若使温度达到一个让人满意的状态（这里是维持在58℃，也可以是使温度线性上升等等），这是最优控制的内涵。")],-1),f=n(`<p><strong>所以，最优控制或者模型预测控制最根本的数学内涵是优化——多变量优化</strong>。这也是为什么能用OptimizationProblem来处理控制问题。</p><h3 id="构建问题" tabindex="-1"><a class="header-anchor" href="#构建问题" aria-hidden="true">#</a> 构建问题</h3><p>首先明确问题。现在假设以一个恒定功率（p=80）加热物体，环境温度18℃，初始温度20℃,散热系数α = 0.2,加热系数β = 0.1。先求解该问题。</p><div class="language-julia line-numbers-mode" data-ext="julia"><pre class="language-julia"><code><span class="token keyword">using</span> Plots<span class="token punctuation">,</span>DifferentialEquations
Tout <span class="token operator">=</span> <span class="token number">18.0</span>
α <span class="token operator">=</span> <span class="token number">0.2</span>
β <span class="token operator">=</span> <span class="token number">0.1</span>
f<span class="token punctuation">(</span>x<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">)</span> <span class="token operator">=</span> α<span class="token operator">*</span><span class="token punctuation">(</span>Tout <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">+</span> β<span class="token operator">*</span>p
tspan<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">40.0</span><span class="token punctuation">)</span>
u0 <span class="token operator">=</span> <span class="token number">20.0</span>
p <span class="token operator">=</span> <span class="token number">80.0</span>
pr <span class="token operator">=</span> ODEProblem<span class="token punctuation">(</span>f<span class="token punctuation">,</span>u0<span class="token punctuation">,</span>tspan<span class="token punctuation">,</span>p<span class="token punctuation">)</span>
sol <span class="token operator">=</span> solve<span class="token punctuation">(</span>pr<span class="token punctuation">)</span>
plot<span class="token punctuation">(</span>sol<span class="token punctuation">,</span>ylimit<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>得到的结果是：<br><img src="`+p+`" alt="图 1" loading="lazy"></p><p>很清晰可以看到，温度缓慢上升最后稳定在58℃。那么作为我们拍脑袋的控制策略来说，这个控制问题很简单。<strong>我们可以先让功率在前期比较大（比如说150），等温度到了58℃附近，再把功率调回80</strong>，就可以实现“温度迅速上升并最后稳定在58度”。</p><h3 id="优化求解" tabindex="-1"><a class="header-anchor" href="#优化求解" aria-hidden="true">#</a> 优化求解</h3><div class="language-julia line-numbers-mode" data-ext="julia"><pre class="language-julia"><code><span class="token keyword">using</span> Symbolics<span class="token punctuation">,</span>ModelingToolkit<span class="token punctuation">,</span>GalacticOptim<span class="token punctuation">,</span>Optim
N <span class="token operator">=</span> <span class="token number">20</span>
Tout <span class="token operator">=</span> <span class="token number">18.0</span>
T0 <span class="token operator">=</span> <span class="token number">20.0</span>
dt <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">/</span>N
Loss <span class="token operator">=</span> <span class="token number">0.0</span>
T <span class="token operator">=</span> T0
α <span class="token operator">=</span> <span class="token number">0.2</span>
β <span class="token operator">=</span> <span class="token number">0.1</span>
@variables u<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">:</span>N
    <span class="token keyword">global</span> T <span class="token operator">=</span> T <span class="token operator">+</span> <span class="token punctuation">(</span>α<span class="token operator">*</span><span class="token punctuation">(</span>Tout <span class="token operator">-</span> T<span class="token punctuation">)</span> <span class="token operator">+</span> β<span class="token operator">*</span>u<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>dt
    <span class="token keyword">global</span> Loss <span class="token operator">+=</span> <span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">58.0</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>u是符号量，离散的个数为N，上面选择离散为20个变量。通过一个for循环，就可以迭代求解20个点上的温度值并且构建Loss方程。<strong>这里的20个变量，就是控制的核心，通过改变这20个不同时间点上的控制量（加热功率）的值，使得被控量（温度）接近“更好、更快”地接近目标——58℃</strong>。</p><p>可以看到Loss方程的结果：</p><figure><img src="`+m+`" alt="图 2" tabindex="0" loading="lazy"><figcaption>图 2</figcaption></figure><p>有些许复杂，但在情理之中。</p><div class="language-julia line-numbers-mode" data-ext="julia"><pre class="language-julia"><code>@named sys <span class="token operator">=</span> OptimizationSystem<span class="token punctuation">(</span>Loss<span class="token punctuation">,</span><span class="token punctuation">[</span>u<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>inequality_constraints<span class="token operator">=</span>inequ<span class="token punctuation">)</span>
u0 <span class="token operator">=</span> <span class="token punctuation">[</span>u<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1.0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
lb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
ub <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">200.0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span>
prob <span class="token operator">=</span> OptimizationProblem<span class="token punctuation">(</span>sys<span class="token punctuation">,</span>u0<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lb <span class="token operator">=</span> lb<span class="token punctuation">,</span>ub <span class="token operator">=</span> ub<span class="token punctuation">,</span>grad<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span>hess<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> solve<span class="token punctuation">(</span>prob<span class="token punctuation">,</span>Optim<span class="token punctuation">.</span>LBFGS<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后构建System和OptimizationProblem，给定上下限。这里功率上限设为200，最后求解！</p><p>结果为：</p><div class="language-julia line-numbers-mode" data-ext="julia"><pre class="language-julia"><code>u<span class="token punctuation">:</span> <span class="token number">20</span><span class="token operator">-</span>element Vector<span class="token punctuation">{</span>Float64<span class="token punctuation">}</span><span class="token punctuation">:</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999997</span>
 <span class="token number">199.99999999999994</span>
 <span class="token number">199.99999999999991</span>
 <span class="token number">199.9999999999999</span>
 <span class="token number">199.99999999999957</span>
 <span class="token number">199.99999999996504</span>
  <span class="token number">82.18673442597857</span>
  <span class="token number">79.99995550035416</span>
  <span class="token number">80.0000502201614</span>
  <span class="token number">79.99991729083732</span>
  <span class="token number">80.00001272875645</span>
  <span class="token number">80.00004827285969</span>
  <span class="token number">79.99999940246633</span>
  <span class="token number">79.99997217751334</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+u+'" alt="图 3" tabindex="0" loading="lazy"><figcaption>图 3</figcaption></figure><p>应该说是非常理想的。和我们设想的一样。先以最大功率加热到58℃附近，然后迅速将到稳态维持58℃的功率80，这样2s就完成了控制过程，而之前以恒定功率80加热，耗费了20s!</p><hr><p>从图中可以很容易看出局限性，加热功率先猛加，以最高限度200直接加热到58，然后功率在恒定在80维持恒温58摄氏度。这种直上直下的调节，很显然不那么让人满意。可以想象，假如不给变量设置上下限，那么优化的结果一定是：第一个离散的变量加热功率上万，相当于在<strong>一瞬间使用超大且精准的功率把温度加到58摄氏度</strong>。第二个往后的状态量为80——维持恒温58摄氏度的加热功率。</p><p>这在数学上是合理的，在实际中却没有意义。所以在控制中一般需要加一些约束，比如加热功率上下限、加热功率变化幅度。</p>',21);function w(M,T){const t=o("RouterLink");return c(),r("div",null,[h,s("p",null,[a("因为MTK使用runge_kutta_discretize（龙格库塔离散）函数将问题离散。问题离散后，传入OptimizationSystem，而OptimizationSystem目前有一个缺陷——不能接受问题的约束。所以，即使用龙格库塔离散离散出控制过程中的多个状态量，在变量没有约束时，优化结果没有意义。（离散的概念在"),e(t,{to:"/docs/Optimization/95-%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E5%8F%82%E6%95%B0%E8%BE%A8%E8%AF%86%E5%AE%9E%E4%BE%8B.html"},{default:l(()=>[a("微分方程参数辨识")]),_:1}),a("中有提及）"),k,a(" 在实例过后，这一点会有清晰的体现。")]),g,v,b,y,x,_,f,s("p",null,[a("所以，为了处理约束，可以"),e(t,{to:"/docs/07Control/JuMPMPC.html"},{default:l(()=>[a("使用JuMP来做MPC")]),_:1}),a("。")])])}const O=i(d,[["render",w],["__file","MTKMPC.html.vue"]]);export{O as default};
